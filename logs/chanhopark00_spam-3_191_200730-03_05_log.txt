Downloading: "https://download.pytorch.org/models/vgg16-397923af.pth" to /home/nsml/.cache/torch/checkpoints/vgg16-397923af.pth
  0%|          | 0.00/528M [00:00<?, ?B/s]  2%|▏         | 9.94M/528M [00:00<00:05, 104MB/s]  4%|▍         | 20.4M/528M [00:00<00:05, 106MB/s]  6%|▌         | 30.1M/528M [00:00<00:05, 104MB/s]  8%|▊         | 40.6M/528M [00:00<00:04, 106MB/s] 10%|▉         | 50.4M/528M [00:00<00:04, 105MB/s] 11%|█▏        | 60.6M/528M [00:00<00:04, 105MB/s] 13%|█▎        | 69.9M/528M [00:00<00:04, 103MB/s] 15%|█▌        | 80.5M/528M [00:00<00:04, 105MB/s] 17%|█▋        | 90.0M/528M [00:00<00:04, 98.6MB/s] 19%|█▉        | 100M/528M [00:01<00:04, 101MB/s]   21%|██        | 110M/528M [00:01<00:04, 98.3MB/s] 23%|██▎       | 120M/528M [00:01<00:04, 101MB/s]  25%|██▍       | 130M/528M [00:01<00:04, 98.1MB/s] 26%|██▋       | 139M/528M [00:01<00:04, 99.3MB/s] 28%|██▊       | 149M/528M [00:01<00:04, 96.1MB/s] 30%|███       | 159M/528M [00:01<00:03, 99.4MB/s] 32%|███▏      | 169M/528M [00:01<00:03, 100MB/s]  34%|███▍      | 179M/528M [00:01<00:03, 102MB/s] 36%|███▌      | 189M/528M [00:02<00:04, 87.0MB/s] 38%|███▊      | 198M/528M [00:02<00:04, 86.3MB/s] 39%|███▉      | 207M/528M [00:02<00:04, 73.6MB/s] 41%|████      | 216M/528M [00:02<00:04, 78.2MB/s] 43%|████▎     | 225M/528M [00:02<00:03, 82.1MB/s] 45%|████▍     | 236M/528M [00:02<00:03, 88.7MB/s] 47%|████▋     | 246M/528M [00:02<00:03, 92.8MB/s] 48%|████▊     | 255M/528M [00:02<00:03, 93.6MB/s] 50%|█████     | 266M/528M [00:02<00:02, 98.4MB/s] 52%|█████▏    | 275M/528M [00:03<00:02, 97.2MB/s] 54%|█████▍    | 285M/528M [00:03<00:02, 98.9MB/s] 56%|█████▌    | 294M/528M [00:03<00:02, 98.8MB/s] 58%|█████▊    | 304M/528M [00:03<00:02, 98.2MB/s] 59%|█████▉    | 314M/528M [00:03<00:02, 99.9MB/s] 61%|██████▏   | 324M/528M [00:03<00:02, 103MB/s]  64%|██████▎   | 335M/528M [00:03<00:01, 106MB/s] 65%|██████▌   | 345M/528M [00:03<00:01, 102MB/s] 67%|██████▋   | 355M/528M [00:03<00:01, 92.2MB/s] 69%|██████▉   | 365M/528M [00:03<00:01, 93.9MB/s] 71%|███████   | 374M/528M [00:04<00:01, 96.2MB/s] 73%|███████▎  | 384M/528M [00:04<00:01, 97.4MB/s] 75%|███████▍  | 393M/528M [00:04<00:01, 96.0MB/s] 76%|███████▋  | 403M/528M [00:04<00:01, 93.1MB/s] 78%|███████▊  | 412M/528M [00:04<00:01, 95.6MB/s] 80%|████████  | 423M/528M [00:04<00:01, 100MB/s]  82%|████████▏ | 433M/528M [00:04<00:01, 95.2MB/s] 84%|████████▍ | 442M/528M [00:04<00:00, 95.8MB/s] 86%|████████▌ | 451M/528M [00:04<00:00, 96.1MB/s] 87%|████████▋ | 461M/528M [00:04<00:00, 96.9MB/s] 89%|████████▉ | 470M/528M [00:05<00:00, 94.8MB/s] 91%|█████████ | 480M/528M [00:05<00:00, 96.6MB/s] 93%|█████████▎| 490M/528M [00:05<00:00, 98.1MB/s] 95%|█████████▍| 499M/528M [00:05<00:00, 99.2MB/s] 96%|█████████▋| 509M/528M [00:05<00:00, 96.9MB/s] 98%|█████████▊| 518M/528M [00:05<00:00, 95.4MB/s]100%|██████████| 528M/528M [00:05<00:00, 96.8MB/s]
VGG16 Loaded!
before fit
Trying out 64 number of hyperparameter combinations!
{'batch_size': 128,
 'class_ratio': [1, 0.2, 0.3, 0.9],
 'epoch': [3, 10],
 'gamma': 0.3,
 'learning_rate': 0.0001,
 'loss_cls_weight': tensor([1.0000, 1.0000, 1.0000, 1.2000]),
 'optimizer': 'Adam',
 'step_size': 2,
 'transforms': [3,
                Compose(
    ColorJitter(brightness=None, contrast=None, saturation=[0.9, 1.1], hue=[-0.1, 0.1])
    RandomHorizontalFlip(p=0.5)
    RandomVerticalFlip(p=0.5)
    ToTensor()
    Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
)],
 'val_ratio': [0.025, 0.2, 0.15, 0.15],
 'weight_decay': 0}
Dataloader constructed! 
	 Train size = 157772 	Validation size = 2559
	 Validation dataset composition  [60, 5, 7, 26]
	 Training dataset composition  [65739, 13147, 19721, 59165]
	 Training dataset proportion  [41, 8, 12, 37]
Epoch: 0, batch loss: 0.01882 Loss Sum: 135.20144, accuracy : 0.96130, val loss: 5.43191, val accuracy: 0.93943
[[1517    2    0   29]
 [   6  119    0    4]
 [   0    0  174   18]
 [  86    4    6  594]]
[[0.97997416 0.00129199 0.         0.01873385]
 [0.04651163 0.92248062 0.         0.03100775]
 [0.         0.         0.90625    0.09375   ]
 [0.12463768 0.0057971  0.00869565 0.86086957]]
	 Final score: 0.9032855386018747 [('val/VGG16/monotone/f1-score', 0.937007874015748), ('val/VGG16/screenshot/f1-score', 0.9354838709677419), ('val/VGG16/unknown/f1-score', 0.8898876404494381)] 0.018733850129198967
	 Time elapsed : 1494.20448 _________________________________

Trying to save to /tmp/tmplqr1zbdp/model_VGG16
Epoch: 1, batch loss: 0.01549 Loss Sum: 38.56221, accuracy : 0.99005, val loss: 7.85518, val accuracy: 0.93318
[[1524    0    0   24]
 [   5  121    0    3]
 [   0    0  182   10]
 [ 112    4   13  561]]
[[0.98449612 0.         0.         0.01550388]
 [0.03875969 0.9379845  0.         0.02325581]
 [0.         0.         0.94791667 0.05208333]
 [0.16231884 0.0057971  0.01884058 0.81304348]]
	 Final score: 0.906491420264641 [('val/VGG16/monotone/f1-score', 0.952755905511811), ('val/VGG16/screenshot/f1-score', 0.9405684754521964), ('val/VGG16/unknown/f1-score', 0.8711180124223603)] 0.015503875968992248
	 Time elapsed : 2997.26457 _________________________________

Trying to save to /tmp/tmpx_4vak2u/model_VGG16
Epoch: 2, batch loss: 0.00146 Loss Sum: 11.17838, accuracy : 0.99727, val loss: 11.76846, val accuracy: 0.92927
[[1528    1    0   19]
 [   5  121    0    3]
 [   1    0  182    9]
 [ 125    4   14  547]]
[[9.87080103e-01 6.45994832e-04 0.00000000e+00 1.22739018e-02]
 [3.87596899e-02 9.37984496e-01 0.00000000e+00 2.32558140e-02]
 [5.20833333e-03 0.00000000e+00 9.47916667e-01 4.68750000e-02]
 [1.81159420e-01 5.79710145e-03 2.02898551e-02 7.92753623e-01]]
	 Final score: 0.9045880226174077 [('val/VGG16/monotone/f1-score', 0.9490196078431372), ('val/VGG16/screenshot/f1-score', 0.9381443298969072), ('val/VGG16/unknown/f1-score', 0.862776025236593)] 0.01227390180878553
	 Time elapsed : 4510.27960 _________________________________

Epoch: 3, batch loss: 0.00137 Loss Sum: 19.15136, accuracy : 0.99499, val loss: 9.13059, val accuracy: 0.93200
[[1531    2    0   15]
 [   6  121    0    2]
 [   0    0  181   11]
 [ 124    3   11  552]]
[[0.98901809 0.00129199 0.         0.00968992]
 [0.04651163 0.9379845  0.         0.01550388]
 [0.         0.         0.94270833 0.05729167]
 [0.17971014 0.00434783 0.01594203 0.8       ]]
	 Final score: 0.910703823433904 [('val/VGG16/monotone/f1-score', 0.9490196078431372), ('val/VGG16/screenshot/f1-score', 0.9427083333333334), ('val/VGG16/unknown/f1-score', 0.8692913385826773)] 0.009689922480620155
	 Time elapsed : 1514.96254 _________________________________

Trying to save to /tmp/tmpgv86fqyv/model_VGG16
Epoch: 4, batch loss: 0.00010 Loss Sum: 5.14571, accuracy : 0.99876, val loss: 12.66829, val accuracy: 0.92771
[[1536    0    0   12]
 [  11  117    0    1]
 [   0    0  180   12]
 [ 134    2   13  541]]
[[0.99224806 0.         0.         0.00775194]
 [0.08527132 0.90697674 0.         0.00775194]
 [0.         0.         0.9375     0.0625    ]
 [0.1942029  0.00289855 0.01884058 0.78405797]]
	 Final score: 0.9055270936846641 [('val/VGG16/monotone/f1-score', 0.9435483870967741), ('val/VGG16/screenshot/f1-score', 0.935064935064935), ('val/VGG16/unknown/f1-score', 0.8614649681528662)] 0.007751937984496124
	 Time elapsed : 3046.67062 _________________________________

Epoch: 5, batch loss: 0.00004 Loss Sum: 3.08297, accuracy : 0.99932, val loss: 14.02196, val accuracy: 0.93083
[[1535    2    0   11]
 [   7  120    0    2]
 [   0    0  182   10]
 [ 133    2   10  545]]
[[0.99160207 0.00129199 0.         0.00710594]
 [0.05426357 0.93023256 0.         0.01550388]
 [0.         0.         0.94791667 0.05208333]
 [0.19275362 0.00289855 0.01449275 0.78985507]]
	 Final score: 0.913633096074413 [('val/VGG16/monotone/f1-score', 0.9486166007905139), ('val/VGG16/screenshot/f1-score', 0.9479166666666666), ('val/VGG16/unknown/f1-score', 0.8664546899841018)] 0.0071059431524547806
	 Time elapsed : 4566.95925 _________________________________

Trying to save to /tmp/tmp5_i7qwgu/model_VGG16
Epoch: 6, batch loss: 0.00028 Loss Sum: 2.10258, accuracy : 0.99958, val loss: 19.10647, val accuracy: 0.92380
[[1541    0    0    7]
 [   9  119    0    1]
 [   1    0  182    9]
 [ 158    2    8  522]]
[[0.99547804 0.         0.         0.00452196]
 [0.06976744 0.92248062 0.         0.00775194]
 [0.00520833 0.         0.94791667 0.046875  ]
 [0.22898551 0.00289855 0.0115942  0.75652174]]
	 Final score: 0.9126541031763279 [('val/VGG16/monotone/f1-score', 0.9520000000000001), ('val/VGG16/screenshot/f1-score', 0.9528795811518324), ('val/VGG16/unknown/f1-score', 0.8494711147274208)] 0.004521963824289405
	 Time elapsed : 6090.86842 _________________________________

Epoch: 7, batch loss: 0.00005 Loss Sum: 1.09469, accuracy : 0.99977, val loss: 19.59525, val accuracy: 0.92575
[[1538    1    0    9]
 [   8  120    0    1]
 [   1    0  178   13]
 [ 148    2    7  533]]
[[9.93540052e-01 6.45994832e-04 0.00000000e+00 5.81395349e-03]
 [6.20155039e-02 9.30232558e-01 0.00000000e+00 7.75193798e-03]
 [5.20833333e-03 0.00000000e+00 9.27083333e-01 6.77083333e-02]
 [2.14492754e-01 2.89855072e-03 1.01449275e-02 7.72463768e-01]]
	 Final score: 0.9110044544508038 [('val/VGG16/monotone/f1-score', 0.9523809523809524), ('val/VGG16/screenshot/f1-score', 0.9442970822281168), ('val/VGG16/unknown/f1-score', 0.8555377207062601)] 0.005813953488372093
	 Time elapsed : 7608.40846 _________________________________

Epoch: 8, batch loss: 0.00012 Loss Sum: 0.76366, accuracy : 0.99984, val loss: 19.26738, val accuracy: 0.92732
[[1538    1    0    9]
 [  10  118    0    1]
 [   0    0  181   11]
 [ 143    2    9  536]]
[[9.93540052e-01 6.45994832e-04 0.00000000e+00 5.81395349e-03]
 [7.75193798e-02 9.14728682e-01 0.00000000e+00 7.75193798e-03]
 [0.00000000e+00 0.00000000e+00 9.42708333e-01 5.72916667e-02]
 [2.07246377e-01 2.89855072e-03 1.30434783e-02 7.76811594e-01]]
	 Final score: 0.9108555482826003 [('val/VGG16/monotone/f1-score', 0.944), ('val/VGG16/screenshot/f1-score', 0.9476439790575917), ('val/VGG16/unknown/f1-score', 0.8596631916599841)] 0.005813953488372093
	 Time elapsed : 9133.46331 _________________________________

Early stopping!! 
---train finished---
VGG16 Loaded!
{'batch_size': 128,
 'class_ratio': [1, 0.2, 0.3, 0.5],
 'epoch': [0, 15],
 'gamma': 0.3,
 'learning_rate': 0.0001,
 'loss_cls_weight': tensor([1.0000, 1.0000, 1.0000, 1.1000]),
 'optimizer': 'Adam',
 'step_size': 5,
 'transforms': [3,
                Compose(
    ColorJitter(brightness=None, contrast=None, saturation=[0.9, 1.1], hue=[-0.1, 0.1])
    RandomHorizontalFlip(p=0.5)
    RandomVerticalFlip(p=0.5)
    ToTensor()
    Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
)],
 'val_ratio': [0.025, 0.2, 0.15, 0.15],
 'weight_decay': 0}
Dataloader constructed! 
	 Train size = 131476 	Validation size = 2559
	 Validation dataset composition  [60, 5, 7, 26]
	 Training dataset composition  [65739, 13147, 19721, 32869]
	 Training dataset proportion  [50, 9, 14, 25]
Epoch: 0, batch loss: 0.00718 Loss Sum: 144.95742, accuracy : 0.95061, val loss: 4.43792, val accuracy: 0.93826
[[1519    1    0   28]
 [   3  121    0    5]
 [   0    0  189    3]
 [  83    3   32  572]]
[[9.81266150e-01 6.45994832e-04 0.00000000e+00 1.80878553e-02]
 [2.32558140e-02 9.37984496e-01 0.00000000e+00 3.87596899e-02]
 [0.00000000e+00 0.00000000e+00 9.84375000e-01 1.56250000e-02]
 [1.20289855e-01 4.34782609e-03 4.63768116e-02 8.28985507e-01]]
	 Final score: 0.8994234535041805 [('val/VGG16/monotone/f1-score', 0.952755905511811), ('val/VGG16/screenshot/f1-score', 0.9152542372881355), ('val/VGG16/unknown/f1-score', 0.8813559322033897)] 0.01808785529715762
	 Time elapsed : 1396.46039 _________________________________

Epoch: 1, batch loss: 0.00240 Loss Sum: 63.72721, accuracy : 0.97902, val loss: 5.49322, val accuracy: 0.93279
[[1477    0    0   71]
 [   6  117    0    6]
 [   0    0  183    9]
 [  66    2   12  610]]
[[0.95413437 0.         0.         0.04586563]
 [0.04651163 0.90697674 0.         0.04651163]
 [0.         0.         0.953125   0.046875  ]
 [0.09565217 0.00289855 0.0173913  0.88405797]]
	 Final score: 0.8803455462079112 [('val/VGG16/monotone/f1-score', 0.9435483870967741), ('val/VGG16/screenshot/f1-score', 0.9457364341085271), ('val/VGG16/unknown/f1-score', 0.8802308802308803)] 0.0458656330749354
	 Time elapsed : 2791.23789 _________________________________

Epoch: 2, batch loss: 0.01334 Loss Sum: 43.67003, accuracy : 0.98591, val loss: 7.77117, val accuracy: 0.92849
[[1532    1    0   15]
 [   9  118    0    2]
 [   1    0  179   12]
 [ 132    4    7  547]]
[[9.89664083e-01 6.45994832e-04 0.00000000e+00 9.68992248e-03]
 [6.97674419e-02 9.14728682e-01 0.00000000e+00 1.55038760e-02]
 [5.20833333e-03 0.00000000e+00 9.32291667e-01 6.25000000e-02]
 [1.91304348e-01 5.79710145e-03 1.01449275e-02 7.92753623e-01]]
	 Final score: 0.9062888430636515 [('val/VGG16/monotone/f1-score', 0.9365079365079364), ('val/VGG16/screenshot/f1-score', 0.9470899470899472), ('val/VGG16/unknown/f1-score', 0.8641390205371248)] 0.009689922480620155
	 Time elapsed : 4191.22321 _________________________________

Epoch: 3, batch loss: 0.07817 Loss Sum: 33.13730, accuracy : 0.98896, val loss: 7.27019, val accuracy: 0.94295
[[1520    1    0   27]
 [   5  121    0    3]
 [   0    0  186    6]
 [  93    3    8  586]]
[[9.81912145e-01 6.45994832e-04 0.00000000e+00 1.74418605e-02]
 [3.87596899e-02 9.37984496e-01 0.00000000e+00 2.32558140e-02]
 [0.00000000e+00 0.00000000e+00 9.68750000e-01 3.12500000e-02]
 [1.34782609e-01 4.34782609e-03 1.15942029e-02 8.49275362e-01]]
	 Final score: 0.9197474902816023 [('val/VGG16/monotone/f1-score', 0.952755905511811), ('val/VGG16/screenshot/f1-score', 0.9637305699481865), ('val/VGG16/unknown/f1-score', 0.8932926829268293)] 0.01744186046511628
	 Time elapsed : 5592.35413 _________________________________

Trying to save to /tmp/tmps97ykp_a/model_VGG16
Epoch: 4, batch loss: 0.00186 Loss Sum: 29.61006, accuracy : 0.99065, val loss: 5.86991, val accuracy: 0.93943
[[1508    5    0   35]
 [   3  124    0    2]
 [   0    0  182   10]
 [  90    5    5  590]]
[[0.97416021 0.00322997 0.         0.02260982]
 [0.02325581 0.96124031 0.         0.01550388]
 [0.         0.         0.94791667 0.05208333]
 [0.13043478 0.00724638 0.00724638 0.85507246]]
	 Final score: 0.9093359657497718 [('val/VGG16/monotone/f1-score', 0.9429657794676807), ('val/VGG16/screenshot/f1-score', 0.9604221635883904), ('val/VGG16/unknown/f1-score', 0.8892238131122834)] 0.02260981912144703
	 Time elapsed : 6995.88759 _________________________________

Epoch: 5, batch loss: 0.00006 Loss Sum: 8.21234, accuracy : 0.99763, val loss: 11.40683, val accuracy: 0.93630
[[1531    2    0   15]
 [   6  121    0    2]
 [   0    0  181   11]
 [ 117    3    7  563]]
[[0.98901809 0.00129199 0.         0.00968992]
 [0.04651163 0.9379845  0.         0.01550388]
 [0.         0.         0.94270833 0.05729167]
 [0.16956522 0.00434783 0.01014493 0.81594203]]
	 Final score: 0.9172780585908957 [('val/VGG16/monotone/f1-score', 0.9490196078431372), ('val/VGG16/screenshot/f1-score', 0.9526315789473685), ('val/VGG16/unknown/f1-score', 0.879000780640125)] 0.009689922480620155
	 Time elapsed : 8395.64745 _________________________________

Epoch: 6, batch loss: 0.00020 Loss Sum: 4.49009, accuracy : 0.99869, val loss: 11.61619, val accuracy: 0.93943
[[1531    0    0   17]
 [   9  117    0    3]
 [   1    0  182    9]
 [ 106    3    7  574]]
[[0.98901809 0.         0.         0.01098191]
 [0.06976744 0.90697674 0.         0.02325581]
 [0.00520833 0.         0.94791667 0.046875  ]
 [0.15362319 0.00434783 0.01014493 0.83188406]]
	 Final score: 0.9170288413909368 [('val/VGG16/monotone/f1-score', 0.9397590361445783), ('val/VGG16/screenshot/f1-score', 0.9553805774278215), ('val/VGG16/unknown/f1-score', 0.8878576952822892)] 0.010981912144702842
	 Time elapsed : 9799.70203 _________________________________

Early stopping!! 
---train finished---
VGG16 Loaded!
{'batch_size': 128,
 'class_ratio': [1, 0.2, 0.3, 0.5],
 'epoch': [0, 15],
 'gamma': 0.3,
 'learning_rate': 0.0001,
 'loss_cls_weight': tensor([1.0000, 1.0000, 1.0000, 1.2000]),
 'optimizer': 'Adam',
 'step_size': 2,
 'transforms': [3,
                Compose(
    ColorJitter(brightness=None, contrast=None, saturation=[0.9, 1.1], hue=[-0.1, 0.1])
    RandomHorizontalFlip(p=0.5)
    RandomVerticalFlip(p=0.5)
    ToTensor()
    Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
)],
 'val_ratio': [0.025, 0.2, 0.15, 0.15],
 'weight_decay': 0.001}
Dataloader constructed! 
	 Train size = 131476 	Validation size = 2559
	 Validation dataset composition  [60, 5, 7, 26]
	 Training dataset composition  [65739, 13147, 19721, 32869]
	 Training dataset proportion  [50, 9, 14, 25]
Epoch: 0, batch loss: 0.00388 Loss Sum: 155.46144, accuracy : 0.94861, val loss: 4.80482, val accuracy: 0.93708
[[1528    2    0   18]
 [   3  125    0    1]
 [   0    0  183    9]
 [ 115    3   10  562]]
[[0.9870801  0.00129199 0.         0.01162791]
 [0.02325581 0.96899225 0.         0.00775194]
 [0.         0.         0.953125   0.046875  ]
 [0.16666667 0.00434783 0.01449275 0.81449275]]
	 Final score: 0.9197280993326967 [('val/VGG16/monotone/f1-score', 0.9652509652509652), ('val/VGG16/screenshot/f1-score', 0.9506493506493506), ('val/VGG16/unknown/f1-score', 0.8781249999999999)] 0.011627906976744186
	 Time elapsed : 1401.76067 _________________________________

Epoch: 1, batch loss: 0.00181 Loss Sum: 96.16972, accuracy : 0.96775, val loss: 7.68392, val accuracy: 0.92028
[[1540    3    0    5]
 [   7  121    0    1]
 [   2    0  179   11]
 [ 158    7   10  515]]
[[0.99483204 0.00193798 0.         0.00322997]
 [0.05426357 0.9379845  0.         0.00775194]
 [0.01041667 0.         0.93229167 0.05729167]
 [0.22898551 0.01014493 0.01449275 0.74637681]]
	 Final score: 0.9004307799186754 [('val/VGG16/monotone/f1-score', 0.9307692307692308), ('val/VGG16/screenshot/f1-score', 0.9396325459317585), ('val/VGG16/unknown/f1-score', 0.8428805237315875)] 0.003229974160206718
	 Time elapsed : 2831.10365 _________________________________

