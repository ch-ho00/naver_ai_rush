Downloading: "https://download.pytorch.org/models/resnet50-19c8e357.pth" to /home/nsml/.cache/torch/checkpoints/resnet50-19c8e357.pth
ResNet50 Loaded!
before fit
Trying out 64 number of hyperparameter combinations!
{'batch_size': 128,
 'class_ratio': [1, 0.2, 0.3, 0.5],
 'epoch': [3, 10],
 'gamma': 0.3,
 'learning_rate': 0.001,
 'loss_cls_weight': tensor([1.0000, 1.0000, 1.0000, 1.1000]),
 'optimizer': 'Adam',
 'step_size': 2,
 'transforms': [3,
                Compose(
    ColorJitter(brightness=None, contrast=None, saturation=[0.9, 1.1], hue=[-0.1, 0.1])
    RandomHorizontalFlip(p=0.5)
    RandomVerticalFlip(p=0.5)
    ToTensor()
    Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
)],
 'val_ratio': [0.025, 0.2, 0.15, 0.15],
 'weight_decay': 0}
Dataloader constructed! 
	 Train size = 131476 	Validation size = 2559
	 Validation dataset composition  [60, 5, 7, 26]
	 Training dataset composition  [65739, 13147, 19721, 32869]
	 Training dataset proportion  [50, 9, 14, 25]
Epoch: 0, batch loss: 0.04982 Loss Sum: 123.41916, accuracy : 0.95843, val loss: 3.87745, val accuracy: 0.93826
[[1474    3    0   71]
 [   1  125    0    3]
 [   0    0  188    4]
 [  49    5   22  614]]
[[0.95219638 0.00193798 0.         0.04586563]
 [0.00775194 0.96899225 0.         0.02325581]
 [0.         0.         0.97916667 0.02083333]
 [0.07101449 0.00724638 0.03188406 0.88985507]]
	 Final score: 0.8831608659142535 [('val/ResNet50/monotone/f1-score', 0.9541984732824427), ('val/ResNet50/screenshot/f1-score', 0.9353233830845771), ('val/ResNet50/unknown/f1-score', 0.8885672937771346)] 0.0458656330749354
	 Time elapsed : 1505.54151 _________________________________

Trying to save to /tmp/tmpomtoxez6/model_ResNet50
Epoch: 1, batch loss: 1.54550 Loss Sum: 52.38736, accuracy : 0.98297, val loss: 4.90330, val accuracy: 0.94529
[[1508    3    1   36]
 [   3  124    0    2]
 [   0    0  186    6]
 [  65    4   20  601]]
[[9.74160207e-01 1.93798450e-03 6.45994832e-04 2.32558140e-02]
 [2.32558140e-02 9.61240310e-01 0.00000000e+00 1.55038760e-02]
 [0.00000000e+00 0.00000000e+00 9.68750000e-01 3.12500000e-02]
 [9.42028986e-02 5.79710145e-03 2.89855072e-02 8.71014493e-01]]
	 Final score: 0.9069945855780647 [('val/ResNet50/monotone/f1-score', 0.9538461538461538), ('val/ResNet50/screenshot/f1-score', 0.9323308270676692), ('val/ResNet50/unknown/f1-score', 0.900374531835206)] 0.023255813953488372
	 Time elapsed : 2971.65444 _________________________________

Trying to save to /tmp/tmpearglv37/model_ResNet50
Epoch: 2, batch loss: 0.00110 Loss Sum: 18.22367, accuracy : 0.99448, val loss: 6.03552, val accuracy: 0.95037
[[1528    2    0   18]
 [   3  124    0    2]
 [   0    0  188    4]
 [  76    5   17  592]]
[[0.9870801  0.00129199 0.         0.01162791]
 [0.02325581 0.96124031 0.         0.01550388]
 [0.         0.         0.97916667 0.02083333]
 [0.11014493 0.00724638 0.02463768 0.85797101]]
	 Final score: 0.9247305523972353 [('val/ResNet50/monotone/f1-score', 0.9538461538461538), ('val/ResNet50/screenshot/f1-score', 0.947103274559194), ('val/ResNet50/unknown/f1-score', 0.9065849923430321)] 0.011627906976744186
	 Time elapsed : 4445.49968 _________________________________

Trying to save to /tmp/tmp1utb1o4t/model_ResNet50
Epoch: 3, batch loss: 0.02823 Loss Sum: 82.64133, accuracy : 0.97237, val loss: 5.32713, val accuracy: 0.92966
[[1477    1    3   67]
 [   2  124    0    3]
 [   0    0  186    6]
 [  59    6   33  592]]
[[9.54134367e-01 6.45994832e-04 1.93798450e-03 4.32816537e-02]
 [1.55038760e-02 9.61240310e-01 0.00000000e+00 2.32558140e-02]
 [0.00000000e+00 0.00000000e+00 9.68750000e-01 3.12500000e-02]
 [8.55072464e-02 8.69565217e-03 4.78260870e-02 8.57971014e-01]]
	 Final score: 0.8681772278834782 [('val/ResNet50/monotone/f1-score', 0.9538461538461538), ('val/ResNet50/screenshot/f1-score', 0.8985507246376812), ('val/ResNet50/unknown/f1-score', 0.8718703976435935)] 0.043281653746770024
	 Time elapsed : 1459.39785 _________________________________

Epoch: 4, batch loss: 0.00129 Loss Sum: 19.79945, accuracy : 0.99387, val loss: 6.01501, val accuracy: 0.94099
[[1523    2    0   23]
 [   3  124    0    2]
 [   0    0  187    5]
 [  92    6   18  574]]
[[0.98385013 0.00129199 0.         0.01485788]
 [0.02325581 0.96124031 0.         0.01550388]
 [0.         0.         0.97395833 0.02604167]
 [0.13333333 0.00869565 0.02608696 0.83188406]]
	 Final score: 0.9122884591604995 [('val/ResNet50/monotone/f1-score', 0.9501915708812261), ('val/ResNet50/screenshot/f1-score', 0.9420654911838792), ('val/ResNet50/unknown/f1-score', 0.8871715610510047)] 0.014857881136950904
	 Time elapsed : 2936.54852 _________________________________

Epoch: 5, batch loss: 0.00055 Loss Sum: 11.24390, accuracy : 0.99672, val loss: 7.12698, val accuracy: 0.94021
[[1531    1    1   15]
 [   5  123    0    1]
 [   1    0  187    4]
 [ 107    6   12  565]]
[[9.89018088e-01 6.45994832e-04 6.45994832e-04 9.68992248e-03]
 [3.87596899e-02 9.53488372e-01 0.00000000e+00 7.75193798e-03]
 [5.20833333e-03 0.00000000e+00 9.73958333e-01 2.08333333e-02]
 [1.55072464e-01 8.69565217e-03 1.73913043e-02 8.18840580e-01]]
	 Final score: 0.920522152118741 [('val/ResNet50/monotone/f1-score', 0.9498069498069497), ('val/ResNet50/screenshot/f1-score', 0.9540816326530612), ('val/ResNet50/unknown/f1-score', 0.8862745098039215)] 0.009689922480620155
	 Time elapsed : 4389.91487 _________________________________

Epoch: 6, batch loss: 0.01071 Loss Sum: 4.48641, accuracy : 0.99876, val loss: 6.96655, val accuracy: 0.94803
[[1534    0    1   13]
 [   5  121    0    3]
 [   0    0  189    3]
 [  90    4   14  582]]
[[9.90956072e-01 0.00000000e+00 6.45994832e-04 8.39793282e-03]
 [3.87596899e-02 9.37984496e-01 0.00000000e+00 2.32558140e-02]
 [0.00000000e+00 0.00000000e+00 9.84375000e-01 1.56250000e-02]
 [1.30434783e-01 5.79710145e-03 2.02898551e-02 8.43478261e-01]]
	 Final score: 0.9281234746389815 [('val/ResNet50/monotone/f1-score', 0.952755905511811), ('val/ResNet50/screenshot/f1-score', 0.9545454545454545), ('val/ResNet50/unknown/f1-score', 0.9016266460108443)] 0.008397932816537468
	 Time elapsed : 5843.79391 _________________________________

Trying to save to /tmp/tmpp1ayi7_l/model_ResNet50
Epoch: 7, batch loss: 0.00002 Loss Sum: 2.36734, accuracy : 0.99945, val loss: 8.63309, val accuracy: 0.94334
[[1531    1    1   15]
 [   4  123    0    2]
 [   0    0  188    4]
 [  95    6   17  572]]
[[9.89018088e-01 6.45994832e-04 6.45994832e-04 9.68992248e-03]
 [3.10077519e-02 9.53488372e-01 0.00000000e+00 1.55038760e-02]
 [0.00000000e+00 0.00000000e+00 9.79166667e-01 2.08333333e-02]
 [1.37681159e-01 8.69565217e-03 2.46376812e-02 8.28985507e-01]]
	 Final score: 0.9193573655478002 [('val/ResNet50/monotone/f1-score', 0.9498069498069497), ('val/ResNet50/screenshot/f1-score', 0.9447236180904524), ('val/ResNet50/unknown/f1-score', 0.8916601714731098)] 0.009689922480620155
	 Time elapsed : 7302.38603 _________________________________

Epoch: 8, batch loss: 0.00029 Loss Sum: 1.47342, accuracy : 0.99967, val loss: 8.51549, val accuracy: 0.94373
[[1533    0    0   15]
 [   6  120    0    3]
 [   0    0  187    5]
 [  98    4   13  575]]
[[0.99031008 0.         0.         0.00968992]
 [0.04651163 0.93023256 0.         0.02325581]
 [0.         0.         0.97395833 0.02604167]
 [0.14202899 0.0057971  0.01884058 0.83333333]]
	 Final score: 0.9224098731702636 [('val/ResNet50/monotone/f1-score', 0.9486166007905139), ('val/ResNet50/screenshot/f1-score', 0.9540816326530612), ('val/ResNet50/unknown/f1-score', 0.8928571428571429)] 0.009689922480620155
	 Time elapsed : 8759.06821 _________________________________

Epoch: 9, batch loss: 0.00052 Loss Sum: 1.17688, accuracy : 0.99971, val loss: 8.56834, val accuracy: 0.94295
[[1534    0    0   14]
 [   5  122    0    2]
 [   0    0  188    4]
 [ 105    4   12  569]]
[[0.99095607 0.         0.         0.00904393]
 [0.03875969 0.94573643 0.         0.01550388]
 [0.         0.         0.97916667 0.02083333]
 [0.15217391 0.0057971  0.0173913  0.82463768]]
	 Final score: 0.9262512002014878 [('val/ResNet50/monotone/f1-score', 0.9568627450980393), ('val/ResNet50/screenshot/f1-score', 0.9591836734693877), ('val/ResNet50/unknown/f1-score', 0.8897576231430806)] 0.00904392764857881
	 Time elapsed : 10237.53787 _________________________________

Early stopping!! 
---train finished---
ResNet50 Loaded!
{'batch_size': 128,
 'class_ratio': [1, 0.2, 0.3, 0.9],
 'epoch': [3, 10],
 'gamma': 0.3,
 'learning_rate': 0.0001,
 'loss_cls_weight': tensor([1.0000, 1.0000, 1.0000, 1.1000]),
 'optimizer': 'Adam',
 'step_size': 5,
 'transforms': [3,
                Compose(
    ColorJitter(brightness=None, contrast=None, saturation=[0.9, 1.1], hue=[-0.1, 0.1])
    RandomHorizontalFlip(p=0.5)
    RandomVerticalFlip(p=0.5)
    ToTensor()
    Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
)],
 'val_ratio': [0.025, 0.2, 0.15, 0.15],
 'weight_decay': 0.001}
Dataloader constructed! 
	 Train size = 157772 	Validation size = 2559
	 Validation dataset composition  [60, 5, 7, 26]
	 Training dataset composition  [65739, 13147, 19721, 59165]
	 Training dataset proportion  [41, 8, 12, 37]
Epoch: 0, batch loss: 0.01456 Loss Sum: 111.23807, accuracy : 0.96869, val loss: 4.14026, val accuracy: 0.93943
[[1456    5    1   86]
 [   1  126    0    2]
 [   0    0  184    8]
 [  33    7   12  638]]
[[9.40568475e-01 3.22997416e-03 6.45994832e-04 5.55555556e-02]
 [7.75193798e-03 9.76744186e-01 0.00000000e+00 1.55038760e-02]
 [0.00000000e+00 0.00000000e+00 9.58333333e-01 4.16666667e-02]
 [4.78260870e-02 1.01449275e-02 1.73913043e-02 9.24637681e-01]]
	 Final score: 0.8767702601614462 [('val/ResNet50/monotone/f1-score', 0.9438202247191011), ('val/ResNet50/screenshot/f1-score', 0.9460154241645244), ('val/ResNet50/unknown/f1-score', 0.8960674157303371)] 0.05555555555555555
	 Time elapsed : 1606.75009 _________________________________

Epoch: 1, batch loss: 0.01503 Loss Sum: 47.75966, accuracy : 0.98718, val loss: 4.44331, val accuracy: 0.93513
[[1435    3    1  109]
 [   1  126    0    2]
 [   0    0  189    3]
 [  31    8    8  643]]
[[9.27002584e-01 1.93798450e-03 6.45994832e-04 7.04134367e-02]
 [7.75193798e-03 9.76744186e-01 0.00000000e+00 1.55038760e-02]
 [0.00000000e+00 0.00000000e+00 9.84375000e-01 1.56250000e-02]
 [4.49275362e-02 1.15942029e-02 1.15942029e-02 9.31884058e-01]]
	 Final score: 0.8686857200658465 [('val/ResNet50/monotone/f1-score', 0.9473684210526316), ('val/ResNet50/screenshot/f1-score', 0.9692307692307692), ('val/ResNet50/unknown/f1-score', 0.8887353144436766)] 0.07041343669250646
	 Time elapsed : 3211.93129 _________________________________

Epoch: 2, batch loss: 0.11472 Loss Sum: 38.20957, accuracy : 0.98993, val loss: 5.30071, val accuracy: 0.93005
[[1424    5    1  118]
 [   1  125    0    3]
 [   0    0  189    3]
 [  30    6   12  642]]
[[9.19896641e-01 3.22997416e-03 6.45994832e-04 7.62273902e-02]
 [7.75193798e-03 9.68992248e-01 0.00000000e+00 2.32558140e-02]
 [0.00000000e+00 0.00000000e+00 9.84375000e-01 1.56250000e-02]
 [4.34782609e-02 8.69565217e-03 1.73913043e-02 9.30434783e-01]]
	 Final score: 0.8568988006050465 [('val/ResNet50/monotone/f1-score', 0.9433962264150944), ('val/ResNet50/screenshot/f1-score', 0.9593908629441625), ('val/ResNet50/unknown/f1-score', 0.8818681318681318)] 0.07622739018087855
	 Time elapsed : 4826.84524 _________________________________

Epoch: 3, batch loss: 0.03490 Loss Sum: 63.85978, accuracy : 0.98245, val loss: 5.70439, val accuracy: 0.91168
[[1393    3    0  152]
 [   1  124    0    4]
 [   0    0  182   10]
 [  41    7    8  634]]
[[0.8998708  0.00193798 0.         0.09819121]
 [0.00775194 0.96124031 0.         0.03100775]
 [0.         0.         0.94791667 0.05208333]
 [0.05942029 0.01014493 0.0115942  0.91884058]]
	 Final score: 0.8246508444027001 [('val/ResNet50/monotone/f1-score', 0.9429657794676807), ('val/ResNet50/screenshot/f1-score', 0.9528795811518324), ('val/ResNet50/unknown/f1-score', 0.851006711409396)] 0.09819121447028424
	 Time elapsed : 1613.50350 _________________________________

Epoch: 4, batch loss: 0.03664 Loss Sum: 51.73877, accuracy : 0.98633, val loss: 5.32257, val accuracy: 0.91794
[[1412    4    1  131]
 [   2  126    0    1]
 [   0    0  181   11]
 [  31   10   19  630]]
[[9.12144703e-01 2.58397933e-03 6.45994832e-04 8.46253230e-02]
 [1.55038760e-02 9.76744186e-01 0.00000000e+00 7.75193798e-03]
 [0.00000000e+00 0.00000000e+00 9.42708333e-01 5.72916667e-02]
 [4.49275362e-02 1.44927536e-02 2.75362319e-02 9.13043478e-01]]
	 Final score: 0.8291422782671988 [('val/ResNet50/monotone/f1-score', 0.9368029739776953), ('val/ResNet50/screenshot/f1-score', 0.921119592875318), ('val/ResNet50/unknown/f1-score', 0.861244019138756)] 0.08462532299741603
	 Time elapsed : 3251.40011 _________________________________

Epoch: 5, batch loss: 0.00105 Loss Sum: 12.37802, accuracy : 0.99734, val loss: 4.11352, val accuracy: 0.94451
[[1504    1    0   43]
 [   6  121    0    2]
 [   0    0  181   11]
 [  64    8    7  611]]
[[9.71576227e-01 6.45994832e-04 0.00000000e+00 2.77777778e-02]
 [4.65116279e-02 9.37984496e-01 0.00000000e+00 1.55038760e-02]
 [0.00000000e+00 0.00000000e+00 9.42708333e-01 5.72916667e-02]
 [9.27536232e-02 1.15942029e-02 1.01449275e-02 8.85507246e-01]]
	 Final score: 0.9031145826947614 [('val/ResNet50/monotone/f1-score', 0.9343629343629343), ('val/ResNet50/screenshot/f1-score', 0.9526315789473685), ('val/ResNet50/unknown/f1-score', 0.9005158437730288)] 0.027777777777777776
	 Time elapsed : 4859.94210 _________________________________

Epoch: 6, batch loss: 0.00197 Loss Sum: 9.62401, accuracy : 0.99798, val loss: 4.45628, val accuracy: 0.94568
[[1490    3    0   55]
 [   4  124    0    1]
 [   0    0  185    7]
 [  47    3   19  621]]
[[0.9625323  0.00193798 0.         0.03552972]
 [0.03100775 0.96124031 0.         0.00775194]
 [0.         0.         0.96354167 0.03645833]
 [0.06811594 0.00434783 0.02753623 0.9       ]]
	 Final score: 0.8985728464457198 [('val/ResNet50/monotone/f1-score', 0.9575289575289576), ('val/ResNet50/screenshot/f1-score', 0.9343434343434344), ('val/ResNet50/unknown/f1-score', 0.9039301310043669)] 0.0355297157622739
	 Time elapsed : 6469.75605 _________________________________

Epoch: 7, batch loss: 0.02294 Loss Sum: 10.39514, accuracy : 0.99788, val loss: 4.75306, val accuracy: 0.93865
[[1485    1    1   61]
 [   6  120    0    3]
 [   0    0  180   12]
 [  56    4   13  617]]
[[9.59302326e-01 6.45994832e-04 6.45994832e-04 3.94056848e-02]
 [4.65116279e-02 9.30232558e-01 0.00000000e+00 2.32558140e-02]
 [0.00000000e+00 0.00000000e+00 9.37500000e-01 6.25000000e-02]
 [8.11594203e-02 5.79710145e-03 1.88405797e-02 8.94202899e-01]]
	 Final score: 0.8866153495592007 [('val/ResNet50/monotone/f1-score', 0.9448818897637796), ('val/ResNet50/screenshot/f1-score', 0.9326424870466321), ('val/ResNet50/unknown/f1-score', 0.8922631959508315)] 0.03940568475452196
	 Time elapsed : 8069.41343 _________________________________

